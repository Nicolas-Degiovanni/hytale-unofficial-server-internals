---
description: Architectural reference for ActionParentState
---

# ActionParentState

**Package:** com.hypixel.hytale.server.npc.corecomponents.statememachine
**Type:** Transient

## Definition
```java
// Signature
public class ActionParentState extends ActionBase {
```

## Architecture & Concepts
The ActionParentState is a fundamental component within the server-side NPC decision-making framework. It functions as a direct, imperative command to transition an NPC into a predefined state and sub-state.

Architecturally, it serves as a "fallback" or "default" state setter within a larger behavior tree or state machine. Its primary design purpose is to enforce a specific state when more complex, conditional logic is absent or has been disabled. It acts as a bridge between the declarative NPC asset definitions (where states are defined) and the runtime state of an entity in the game world.

The core operational logic is conditional: it first inspects the target entity for an active StateEvaluator component. If one is found and is active, the ActionParentState yields, allowing the more sophisticated evaluator to control the NPC's state. If no active evaluator is present, this action takes control and directly mutates the NPC's state via its Role.

## Lifecycle & Ownership
-   **Creation:** Instantiated exclusively by the server's NPC asset pipeline. During asset loading, a corresponding BuilderActionParentState definition is processed, which in turn constructs an instance of ActionParentState. It is **not** intended for runtime instantiation during gameplay.
-   **Scope:** Instances are immutable and stateless data-holders. They are part of a shared, canonical NPC behavior template. An instance persists for the entire duration that its parent NPC asset definition is loaded in memory. Multiple NPC entities of the same type will share a reference to the same ActionParentState instance.
-   **Destruction:** The object is garbage collected when its parent NPC asset definition is unloaded from memory, typically occurring during a server shutdown or a hot-reload of game assets.

## Internal State & Concurrency
-   **State:** Immutable. The internal fields, *state* and *subState*, are final and are populated only once during construction from the asset definition. The object itself does not cache any runtime data or maintain any session-specific state.
-   **Thread Safety:** The class instance is inherently thread-safe due to its immutability. However, the *execute* method is a mutating operation on external game state (the entity's components). It is **critically important** that this method is only ever called from the server's main game loop thread for a given entity. Concurrent calls to *execute* on the same entity will lead to race conditions and undefined behavior in the NPC's state machine.

## API Surface

| Symbol | Type | Complexity | Description |
| :--- | :--- | :--- | :--- |
| execute(ref, role, sensorInfo, dt, store) | boolean | O(1) | Executes the state change logic. Conditionally sets the NPC's state and sub-state. Always returns true. |

## Integration Patterns

### Standard Usage
This class is not intended to be invoked directly by developers. It is executed by a higher-level AI scheduler or behavior tree runner as part of an NPC's update tick. The system identifies the current action and calls its execute method.

```java
// Hypothetical invocation from an NPC Behavior Processor

// ActionParentState is the current action for the NPC
ActionBase currentAction = npc.getCurrentBehaviorAction();

if (currentAction instanceof ActionParentState) {
    // The engine invokes execute, passing in the current world state
    currentAction.execute(entityRef, npcRole, sensorInfo, deltaTime, entityStore);
}
```

### Anti-Patterns (Do NOT do this)
-   **Direct Instantiation:** Never create an instance using `new ActionParentState()`. These objects must be generated by the asset loading system to ensure they are correctly configured with state data from the NPC's definition files. Manual creation will result in an unconfigured and non-functional action.
-   **Misuse for Complex Logic:** Do not use this action to handle conditional state transitions. It is a blunt instrument. If an NPC's state depends on environmental factors, health, or proximity to other entities, a StateEvaluator component must be used instead. The presence of an active StateEvaluator correctly suppresses this action.

## Data Pipeline
The ActionParentState sits at the end of the asset definition pipeline and at the beginning of the runtime state mutation pipeline.

> Flow:
> NPC Asset File (JSON/HOCON) -> Asset Deserializer -> BuilderActionParentState -> **ActionParentState Instance** -> AI Behavior Executor -> Role.getStateSupport().setState() -> Entity Component State Change

