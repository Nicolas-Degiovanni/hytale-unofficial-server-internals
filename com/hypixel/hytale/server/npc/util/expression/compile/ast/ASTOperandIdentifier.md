---
description: Architectural reference for ASTOperandIdentifier
---

# ASTOperandIdentifier

**Package:** com.hypixel.hytale.server.npc.util.expression.compile.ast
**Type:** Transient

## Definition
```java
// Signature
public class ASTOperandIdentifier extends ASTOperand {
```

## Architecture & Concepts
The ASTOperandIdentifier is a fundamental node type within the Abstract Syntax Tree (AST) generated by the server's expression language compiler. It represents a named variable or symbol that must be resolved at runtime.

This class serves as a leaf node in the AST, specifically representing an operand that is not a literal value (like a number or string) but rather a reference to a value stored in the ExecutionContext. During the parsing phase, when the lexer produces an identifier token, the parser instantiates an ASTOperandIdentifier to represent that symbol in the tree structure.

Its primary architectural role is to bridge the gap between a compile-time symbol name and its runtime value. It achieves this by holding the identifier's string name and embedding code generation logic that, when invoked, produces an instruction to read a variable from the runtime environment. It explicitly declares itself as non-constant, which is critical for optimization passes that might perform constant folding.

## Lifecycle & Ownership
- **Creation:** Instantiated exclusively by the expression language Parser when it consumes an identifier token from the input stream. It is never created directly by application logic.
- **Scope:** The lifetime of an ASTOperandIdentifier instance is bound to the AST to which it belongs. It exists from the moment it is created by the parser until the entire compiled expression and its corresponding AST are discarded.
- **Destruction:** Ownership is held by the parent node in the AST. The entire tree, including all identifier nodes, becomes eligible for garbage collection after the code generation phase is complete and the resulting executable code is produced. There are no manual destruction or cleanup protocols.

## Internal State & Concurrency
- **State:** This object is effectively immutable. Its core state, the identifier string, is a final field initialized in the constructor. All properties are established at creation and do not change during the object's lifetime. It holds no runtime data or caches.
- **Thread Safety:** ASTOperandIdentifier is inherently thread-safe due to its immutable nature. An AST containing these nodes can be safely read, traversed, or processed by multiple threads simultaneously, provided the tree structure itself is not being modified.

## API Surface
The public API is minimal, focusing on introspection of the compile-time symbol.

| Symbol | Type | Complexity | Description |
| :--- | :--- | :--- | :--- |
| getIdentifier() | String | O(1) | Returns the raw string name of the variable this node represents. |
| isConstant() | boolean | O(1) | Always returns false. Signals to the compiler that this node's value is not known at compile time and cannot be folded. |

## Integration Patterns

### Standard Usage
This class is an internal component of the expression compiler. Direct interaction is rare and typically confined to advanced introspection tools or custom AST visitors. The primary consumer is the code generator, which traverses the AST and invokes the code generation logic embedded in each node.

A hypothetical AST visitor might use it like this:
```java
// A visitor pattern implementation to find all variables used in an expression
public class VariableFinderVisitor extends AstVisitor {
    private final Set<String> foundIdentifiers = new HashSet<>();

    @Override
    public void visit(ASTOperandIdentifier node) {
        // Collect the name of the variable
        foundIdentifiers.add(node.getIdentifier());
    }

    public Set<String> getFoundIdentifiers() {
        return foundIdentifiers;
    }
}
```

### Anti-Patterns (Do NOT do this)
- **Direct Instantiation:** Never construct an ASTOperandIdentifier using its constructor. Doing so bypasses the parser and the tokenization process, leading to an incomplete and invalid AST node that lacks proper context (like token position and value type).
- **Assuming Value Existence:** Do not assume that the variable represented by this node will exist at runtime. This node only captures the *intent* to read a variable; validation of its existence occurs later, during execution against a specific ExecutionContext.

## Data Pipeline
The ASTOperandIdentifier is a key intermediate structure in the expression compilation pipeline. It represents the transformation of a raw text token into a structured, semantic object.

> Flow:
> Expression String -> Lexer -> **Token** (Type: IDENTIFIER, Value: "playerName") -> Parser -> **ASTOperandIdentifier** (identifier: "playerName") -> Code Generator -> Runtime Instruction (e.g., "READ playerName")

