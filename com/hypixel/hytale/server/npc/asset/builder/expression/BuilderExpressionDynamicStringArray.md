---
description: Architectural reference for BuilderExpressionDynamicStringArray
---

# BuilderExpressionDynamicStringArray

**Package:** com.hypixel.hytale.server.npc.asset.builder.expression
**Type:** Transient

## Definition
```java
// Signature
public class BuilderExpressionDynamicStringArray extends BuilderExpressionDynamic {
```

## Architecture & Concepts
The BuilderExpressionDynamicStringArray class is a runtime component of the server-side NPC Expression Language (EL) engine. It represents a *compiled* expression that, when evaluated, produces a string array. This class does not contain parsing or compilation logic; instead, it holds the resulting "bytecode" (an instruction sequence) generated by a separate parser.

Its primary architectural role is to serve as an efficient, reusable executor for a piece of dynamic logic defined in an NPC asset file. By separating the immutable compiled instructions from the transient execution state (managed by ExecutionContext), the system allows a single, pre-compiled expression to be evaluated many times for different NPCs or in different scenarios without the overhead of re-parsing.

This class is one of several type-specific `BuilderExpressionDynamic` implementations, each tailored to a specific return type within the expression language's type system.

### Lifecycle & Ownership
- **Creation:** Instances are created by the NPC asset pipeline during the parsing and compilation of an expression string from a configuration file. The compiler produces an `ExecutionContext.Instruction[]` array, which is then passed into this class's constructor. Direct instantiation by game logic developers is not intended.
- **Scope:** The object's lifetime is bound to the lifecycle of the parent NPC asset that defines it. It is held in memory as part of the asset's object graph and persists as long as the asset is loaded.
- **Destruction:** The object is eligible for garbage collection when the parent NPC asset is unloaded or the server shuts down. It manages no native resources and requires no explicit cleanup.

## Internal State & Concurrency
- **State:** Immutable. The internal state, consisting of the original expression string and the compiled instruction sequence, is set at construction and is never modified. The class itself is stateless regarding execution.
- **Thread Safety:** This class is inherently thread-safe. All mutable state required for evaluation, such as the operand stack, is encapsulated within the `ExecutionContext` object passed as a method parameter. A single BuilderExpressionDynamicStringArray instance can be safely executed by multiple threads concurrently, provided each thread supplies its own unique `ExecutionContext` instance.

## API Surface
The public API is minimal, focusing exclusively on type identification and evaluation.

| Symbol | Type | Complexity | Description |
| :--- | :--- | :--- | :--- |
| getType() | ValueType | O(1) | Returns the constant `ValueType.STRING_ARRAY`, identifying the expression's result type. |
| getStringArray(ExecutionContext) | String[] | O(N) | Executes the instruction sequence against the provided context and returns the resulting string array from the context's stack. N is the number of instructions. |
| updateScope(StdScope, String, ExecutionContext) | void | O(N) | Evaluates the expression and assigns the resulting string array to a named variable within the provided `StdScope`. |

## Integration Patterns

### Standard Usage
This class is typically invoked by higher-level NPC systems, such as a behavior tree or a quest script, that need to resolve a dynamic value. The caller is responsible for creating and populating the `ExecutionContext`.

```java
// Assume 'expression' is a pre-loaded BuilderExpressionDynamicStringArray instance
// Assume 'npc' is the current NPC entity

// 1. Create a fresh execution context for this specific evaluation
ExecutionContext context = new ExecutionContext();

// 2. Populate the context with relevant variables (e.g., self)
context.getScope().changeValue("self", npc);

// 3. Evaluate the expression to get the dynamic string array
String[] targetFactions = expression.getStringArray(context);

// 4. Use the result in game logic
for (String faction : targetFactions) {
    // ...
}
```

### Anti-Patterns (Do NOT do this)
- **Direct Instantiation:** Never use `new BuilderExpressionDynamicStringArray()`. These objects are exclusively created by the internal expression compiler. Attempting to construct one manually will likely lead to a system that cannot be validated by the asset pipeline.
- **Reusing ExecutionContext:** An `ExecutionContext` is stateful and designed for a single, complete evaluation. Reusing the same context instance for multiple evaluations of the same or different expressions without resetting it will cause stack corruption and unpredictable behavior.

## Data Pipeline
The class sits at the end of the asset compilation pipeline and at the beginning of the runtime evaluation pipeline.

> Flow:
> NPC Asset File (JSON/HOCON) -> Expression String Parser -> Compiler -> `Instruction[]` -> **BuilderExpressionDynamicStringArray** (Instantiation) -> Runtime Evaluation with `ExecutionContext` -> `String[]` Result -> NPC Behavior System

