---
description: Architectural reference for BuilderExpressionDynamicBoolean
---

# BuilderExpressionDynamicBoolean

**Package:** com.hypixel.hytale.server.npc.asset.builder.expression
**Type:** Transient

## Definition
```java
// Signature
public class BuilderExpressionDynamicBoolean extends BuilderExpressionDynamic {
```

## Architecture & Concepts
The BuilderExpressionDynamicBoolean class is a runtime component of the server-side NPC expression engine. It represents a pre-compiled, executable expression that is guaranteed to resolve to a boolean value. This class is not a builder itself, but rather the *product* of a parsing and compilation process that transforms a human-readable string (e.g., "health < 50 && hasTarget()") into a highly efficient bytecode-like instruction sequence.

Architecturally, this object acts as a callable function or a "thunk" within the NPC AI and behavior system. It encapsulates the logic of a condition without exposing the underlying instruction set. The evaluation is performed by a lightweight, stack-based virtual machine, where the passed-in ExecutionContext instance serves as the machine's state, including its data stack. This design decouples the static expression logic from the dynamic game state, allowing the same compiled expression to be evaluated against different contexts (e.g., for multiple NPCs of the same type).

### Lifecycle & Ownership
- **Creation:** Instances are created by an internal expression parser when an asset (e.g., an NPC behavior tree definition) is loaded. The parser is responsible for generating the instructionSequence from a source string. Direct instantiation by developers is not a supported use case.
- **Scope:** The object's lifetime is tied to its containing asset. It persists in memory as long as the NPC definition or behavior that uses it is loaded. It is effectively a stateless, reusable blueprint for a calculation.
- **Destruction:** The object is eligible for garbage collection when the root asset that owns it is unloaded from the server.

## Internal State & Concurrency
- **State:** The internal state, consisting of the original expression string and the instructionSequence array, is **immutable** after construction. The object itself is stateless with respect to its execution; all runtime state is managed externally within the provided ExecutionContext.
- **Thread Safety:** This class is inherently **thread-safe**. Because its internal state is immutable, a single BuilderExpressionDynamicBoolean instance can be safely shared and executed by multiple threads simultaneously, provided each thread supplies its own unique, non-shared ExecutionContext instance.

**WARNING:** While the expression object is thread-safe, the ExecutionContext is not. Passing the same ExecutionContext to concurrent calls of getBoolean will result in stack corruption and undefined behavior.

## API Surface
The public API is minimal, focusing exclusively on type identification and evaluation.

| Symbol | Type | Complexity | Description |
| :--- | :--- | :--- | :--- |
| getType() | ValueType | O(1) | Returns the static type of the expression, which is always ValueType.BOOLEAN. |
| getBoolean(executionContext) | boolean | O(N) | Executes the instruction sequence against the context and returns the resulting boolean. N is the number of instructions. |
| updateScope(scope, name, context) | void | O(N) | Evaluates the expression and assigns the result to a named variable within the provided StdScope. |

## Integration Patterns

### Standard Usage
This component is not meant to be retrieved directly. It is typically embedded within a larger configuration or behavior object. The primary interaction pattern involves an owning system (like an AI controller) evaluating the expression during a game tick to make a decision.

```java
// Assume 'npcBehavior' holds a pre-loaded BuilderExpressionDynamicBoolean named 'shouldFleeCondition'
ExecutionContext context = new ExecutionContext();
context.setScope(npc.getExpressionScope()); // Provide NPC-specific variables

// Evaluate the condition to determine if the NPC should flee
boolean shouldFlee = npcBehavior.shouldFleeCondition.getBoolean(context);

if (shouldFlee) {
    npc.getController().startFleeing();
}
```

### Anti-Patterns (Do NOT do this)
- **Direct Instantiation:** Do not use `new BuilderExpressionDynamicBoolean()`. The instruction sequence is opaque and can only be correctly generated by the engine's internal expression compiler. Manually creating this object will lead to runtime errors.
- **Context Reuse Without Reset:** Using the same ExecutionContext for multiple, independent expression evaluations without clearing its stack can lead to stack underflow/overflow errors and incorrect results.

## Data Pipeline
The data flow for this component begins long before runtime, starting with the server assets.

> Flow:
> NPC Asset File (e.g., JSON) -> Server Asset Loader -> Expression Parser -> **BuilderExpressionDynamicBoolean (Instance Created)** -> NPC Behavior System -> Game Tick -> Evaluation with ExecutionContext -> Boolean Result -> AI Decision Logic

