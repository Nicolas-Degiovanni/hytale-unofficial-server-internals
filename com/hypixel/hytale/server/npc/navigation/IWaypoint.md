---
description: Architectural reference for IWaypoint
---

# IWaypoint

**Package:** com.hypixel.hytale.server.npc.navigation
**Type:** Interface / Contract

## Definition
```java
// Signature
public interface IWaypoint {
```

## Architecture & Concepts
The IWaypoint interface defines the fundamental contract for a single node within a calculated navigation path. It is a core component of the server-side NPC pathfinding and path-following system. This interface abstracts the underlying storage of a path, allowing different path structures (e.g., array-backed, linked-list) to be used interchangeably by the navigation logic.

An IWaypoint instance represents a single, discrete point in 3D space that an NPC must traverse. A complete path is represented by a chain of IWaypoint objects, where each point can provide a reference to the subsequent one. This forms a forward-only, immutable sequence that guides an NPC from its starting location to its destination. The design decouples the high-level path-following AI from the low-level details of path generation and storage.

## Lifecycle & Ownership
As an interface, IWaypoint itself has no lifecycle. The lifecycle described here pertains to the concrete objects that implement this contract.

- **Creation:** IWaypoint implementations are exclusively generated by a pathfinding service, such as a server-side A* pathfinder. They are created as a complete, immutable chain in response to a navigation request from an NPC's AI controller. The controller receives only the head of the waypoint chain.
- **Scope:** The scope of a waypoint chain is transient and tied directly to a single navigation task for a single NPC. It is considered ephemeral state.
- **Destruction:** The entire chain of waypoints is eligible for garbage collection as soon as the navigation task is completed, aborted, or superseded by a new path. References to a waypoint chain **must not** be held after the navigation task concludes.

## Internal State & Concurrency
- **State:** The contract implies that any implementing class will be stateful, containing at least a Vector3d for its position and a reference to the next waypoint in the sequence. The path is intended to be immutable upon creation; the state of a waypoint object should not change after it has been generated by the pathfinding service.
- **Thread Safety:** This interface is **not thread-safe**. Waypoint chains are designed to be owned and processed by a single NPC's update logic, which typically executes on a single thread or within a well-defined actor context. Sharing an IWaypoint chain across multiple NPCs or accessing it from multiple threads will lead to race conditions and undefined behavior.

## API Surface

| Symbol | Type | Complexity | Description |
| :--- | :--- | :--- | :--- |
| getLength() | int | O(1) | Returns the total number of waypoints remaining in the path from this point forward. |
| getPosition() | Vector3d | O(1) | Retrieves the world-space coordinates of this specific waypoint. |
| advance(int count) | IWaypoint | O(N) | Returns the waypoint that is N steps ahead in the chain. Returns null if the end is reached. |
| next() | IWaypoint | O(1) | Returns the immediate next waypoint in the sequence. Returns null if this is the final waypoint. |

## Integration Patterns

### Standard Usage
The standard pattern involves an NPC's navigation component receiving the head of an IWaypoint chain. In its update loop, the component directs the NPC towards the current waypoint's position. Once the NPC is within a certain tolerance distance, it calls `next()` to advance to the subsequent waypoint and repeats the process until `next()` returns null, signifying the end of the path.

```java
// Pseudocode for an NPC's navigation update tick
IWaypoint currentTarget = this.navigationTask.getCurrentWaypoint();
if (currentTarget == null) {
    // Path is complete
    return;
}

Vector3d targetPosition = currentTarget.getPosition();
if (this.entity.distanceTo(targetPosition) < ARRIVAL_THRESHOLD) {
    // Advance to the next waypoint
    this.navigationTask.setCurrentWaypoint(currentTarget.next());
} else {
    // Continue moving towards the current target
    this.entity.moveTo(targetPosition);
}
```

### Anti-Patterns (Do NOT do this)
- **External Instantiation:** Never create a class that implements IWaypoint directly. Waypoints must only be obtained from the authoritative server pathfinding service to ensure path validity.
- **Path Modification:** Do not attempt to cast an IWaypoint to a concrete class to modify its internal state (e.g., changing its position or next-node reference). Paths are considered immutable once created.
- **Path Reuse:** Do not cache and reuse a waypoint chain for a new navigation task. Paths are calculated based on world state at a specific moment and can become invalid. Always request a new path.

## Data Pipeline
The IWaypoint interface serves as the data structure that carries the output of the pathfinding system to its consumer, the NPC navigation component.

> Flow:
> Navigation Request (Start/End Coords, NPC properties) -> Server Pathfinder Service -> A* Algorithm -> **IWaypoint Chain (Result)** -> NPC Navigation Component -> Entity Movement System

