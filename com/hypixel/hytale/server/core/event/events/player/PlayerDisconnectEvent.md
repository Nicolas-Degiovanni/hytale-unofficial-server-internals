---
description: Architectural reference for PlayerDisconnectEvent
---

# PlayerDisconnectEvent

**Package:** com.hypixel.hytale.server.core.event.events.player
**Type:** Transient Data Object

## Definition
```java
// Signature
public class PlayerDisconnectEvent extends PlayerRefEvent<Void> {
```

## Architecture & Concepts
The PlayerDisconnectEvent is a fundamental signaling mechanism within the server's event-driven architecture. It is not a service or manager, but rather an immutable message that represents a significant state change: the termination of a player's network session.

This class serves as a decoupling layer between the low-level network stack and high-level game logic. The network component that manages a client's connection is responsible for detecting the disconnection and firing this event. Game systems, such as persistence, world management, and social features, can then subscribe to this event to perform necessary cleanup and state transition logic without needing any direct knowledge of the underlying network implementation.

By encapsulating the identity of the disconnected player (via PlayerRef) and the reason for the disconnection, it provides all necessary context for subscribers to act authoritatively.

### Lifecycle & Ownership
- **Creation:** Instantiated exclusively by the server's core network layer, typically within a session manager or PacketHandler, immediately after a client's connection is confirmed to be closed. This can be triggered by a graceful logout packet, a TCP FIN, a network timeout, or a protocol error.
- **Scope:** Ephemeral. The object's lifespan is strictly limited to the duration of its propagation through the server's central event bus. It is a fire-and-forget message.
- **Destruction:** Once all registered event listeners have processed the event, it falls out of scope and becomes eligible for garbage collection. There is no manual memory management required.

## Internal State & Concurrency
- **State:** Effectively immutable. The internal PlayerRef is assigned during construction and cannot be changed. This design guarantees that all subscribers operate on the exact same, consistent context for a given disconnection event.
- **Thread Safety:** This class is inherently thread-safe. As an immutable data carrier, it can be safely passed between threads without synchronization. It is common for this event to be created on a network I/O thread and consumed by one or more main game logic threads.

## API Surface
The public contract is minimal, focused on providing read-only access to the event's context.

| Symbol | Type | Complexity | Description |
| :--- | :--- | :--- | :--- |
| getPlayerRef() | PlayerRef | O(1) | (Inherited) Returns the reference to the player whose session terminated. This is the primary identifier. |
| getDisconnectReason() | PacketHandler.DisconnectReason | O(1) | Returns the enumerated reason for the disconnection, providing crucial context for logging and conditional logic. |

## Integration Patterns

### Standard Usage
The canonical use of this event is to create a listener method in a service that needs to react to a player leaving. The server's event bus will automatically invoke this method when the event is fired.

```java
// Example within a PlayerPersistenceService
@EventHandler
public void onPlayerDisconnect(PlayerDisconnectEvent event) {
    PlayerRef player = event.getPlayerRef();
    DisconnectReason reason = event.getDisconnectReason();

    log.info("Saving final data for player {} who disconnected due to: {}", player.getName(), reason);
    
    // Trigger asynchronous save operation
    this.database.savePlayerState(player.getProfile());

    // Remove player entity from the world
    this.worldManager.removePlayer(player);
}
```

### Anti-Patterns (Do NOT do this)
- **Manual Instantiation:** **CRITICAL:** Never create an instance of PlayerDisconnectEvent from game logic using `new`. This event must only be generated by the core network engine. Manually firing this event would create a desynchronization between the server's actual connection state and the game's perceived state, leading to severe bugs.
- **State Mutation:** Do not attempt to modify the state of the PlayerRef or its underlying components obtained from the event. The event is a historical record of something that has *already happened*. Any state changes should be performed through dedicated service APIs, not by mutating the event's payload.

## Data Pipeline
The PlayerDisconnectEvent is a key message in the flow of data from the network layer to the game simulation.

> Flow:
> TCP Socket Closure / Timeout -> Network Session Manager -> **PlayerDisconnectEvent (Instantiation)** -> Server Event Bus -> Subscribing Systems (Persistence, World, Chat) -> Database Write / World State Update

