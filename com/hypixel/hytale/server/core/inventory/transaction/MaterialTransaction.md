---
description: Architectural reference for MaterialTransaction
---

# MaterialTransaction

**Package:** com.hypixel.hytale.server.core.inventory.transaction
**Type:** Transient

## Definition
```java
// Signature
public class MaterialTransaction extends ListTransaction<MaterialSlotTransaction> {
```

## Architecture & Concepts
The MaterialTransaction class is an immutable record that represents the result of a high-level, material-based inventory operation. It is not a service or a manager, but rather a detailed receipt generated by the core inventory system in response to a request, such as "add 50 iron ore" or "remove 10 wood planks".

This class acts as a composite result, aggregating a list of finer-grained MaterialSlotTransaction objects. While the MaterialTransaction describes the overall goal and outcome, each contained MaterialSlotTransaction details the exact changes that occurred within a single inventory slot. This two-tiered structure provides both a high-level summary and a low-level, auditable log of changes.

A key architectural function of this class is to enforce and report on transactional constraints like atomicity. The boolean flags, particularly *allOrNothing*, communicate whether a complex operation was fully completed or rolled back, preventing partial state updates in critical game logic.

Furthermore, its design supports hierarchical inventories (e.g., a chest on the ground, a backpack within a player's inventory). The `toParent` and `fromParent` methods provide the essential mechanism for remapping transaction coordinates between different container contexts, allowing a single transaction record to be interpreted correctly at various levels of the inventory hierarchy.

## Lifecycle & Ownership
-   **Creation:** A MaterialTransaction is instantiated exclusively by the server's authoritative inventory service when it processes a request to add or remove materials from an ItemContainer. It is never intended to be created directly by gameplay code.
-   **Scope:** The object's lifetime is exceptionally short and bound to the scope of the method call that generated it. It exists purely as a return value to be immediately inspected by the caller.
-   **Destruction:** The object is eligible for garbage collection as soon as the calling code, which received it as a result, finishes its execution block. It holds no external references and is not registered with any system.

## Internal State & Concurrency
-   **State:** **Immutable**. All fields within this class are final. Upon construction, its state is fixed and cannot be altered. Methods that appear to modify the transaction, such as `toParent`, do not mutate the instance; they return a new MaterialTransaction with transformed data.
-   **Thread Safety:** **Inherently Thread-Safe**. Due to its immutability, a MaterialTransaction instance can be safely read from and passed between multiple threads without any risk of data corruption or race conditions. No synchronization mechanisms are required.

    **Warning:** While the object itself is thread-safe, the inventory systems that *create* it are not. All inventory operations must be performed on the main server thread to ensure data consistency.

## API Surface
The public API provides a read-only view of the transaction's outcome.

| Symbol | Type | Complexity | Description |
| :--- | :--- | :--- | :--- |
| getAction() | ActionType | O(1) | Returns the type of operation (e.g., ADD, REMOVE). |
| getMaterial() | MaterialQuantity | O(1) | Returns the material and quantity that was the target of the operation. |
| getRemainder() | int | O(1) | Returns the amount of the requested quantity that could not be fulfilled. A value of 0 indicates complete success. |
| isAllOrNothing() | boolean | O(1) | Returns true if the operation was configured to only apply if it could be fully completed. |
| toParent(...) | MaterialTransaction | O(N) | Creates a new transaction by remapping its slot data to a parent container's coordinate space. N is the number of child slot transactions. |
| fromParent(...) | MaterialTransaction | O(N) | Creates a new, filtered transaction by remapping coordinates from a parent to a child container. Returns null if no slots map to the child. |

## Integration Patterns

### Standard Usage
A MaterialTransaction should be treated as a read-only receipt. The caller initiates an inventory operation and uses the returned transaction to determine the next step in game logic.

```java
// Standard pattern for requesting to add an item and checking the result.
MaterialQuantity toAdd = new MaterialQuantity(IRON_ORE, 50);
MaterialTransaction result = player.getInventory().add(toAdd);

if (result.succeeded()) {
    int amountAdded = toAdd.getQuantity() - result.getRemainder();
    player.sendMessage("Added " + amountAdded + " Iron Ore.");

    if (result.getRemainder() > 0) {
        player.sendMessage("Your inventory is full. Could not add " + result.getRemainder() + " Iron Ore.");
    }
} else {
    player.sendMessage("Failed to add any Iron Ore.");
}
```

### Anti-Patterns (Do NOT do this)
-   **Direct Instantiation:** Never create an instance using `new MaterialTransaction()`. Doing so creates a synthetic and misleading record that was not processed by the authoritative inventory system. This completely bypasses inventory logic like stacking rules, capacity checks, and event hooks.
-   **Ignoring the Remainder:** A common bug is to only check the `succeeded()` method. A transaction can succeed partially (e.g., fitting 20 of 50 requested items). Always check `getRemainder()` to handle cases where an inventory is partially full.
-   **Assuming Persistence:** Do not hold references to a MaterialTransaction object. It is a transient record of a past event, not a representation of current inventory state. Query the inventory system again for fresh data.

## Data Pipeline
A MaterialTransaction is the terminal output of an inventory operation pipeline. It does not feed into other systems directly; rather, its data is read by the logic that initiated the pipeline.

> Flow:
> Game Logic Request (e.g., `player.getInventory().add(...)`) -> Inventory Service -> ItemContainer Logic -> **MaterialTransaction** (Result) -> Inspected by Game Logic<ctrl63>

