---
description: Architectural reference for SimpleNoiseCarta
---

# SimpleNoiseCarta<T>

**Package:** com.hypixel.hytale.builtin.hytalegenerator.cartas
**Type:** Transient

## Definition
```java
// Signature
public class SimpleNoiseCarta<T> extends BiCarta<T> {
```

## Architecture & Concepts
The SimpleNoiseCarta is a foundational component within the procedural world generation framework. Its primary architectural role is to act as a **translator** or **quantizer**, converting continuous, floating-point noise values into discrete, categorical types.

This class bridges the gap between abstract mathematical noise, generated by a **Density** function, and its concrete application in the game world, such as determining a biome type, block material, or terrain feature. It achieves this by mapping specific ranges of noise output to a corresponding generic value of type T.

For example, a SimpleNoiseCarta can be configured to interpret noise values:
*   from -1.0 to 0.2 as WATER
*   from 0.2 to 0.6 as SAND
*   from 0.6 to 1.0 as GRASS

This design decouples the noise generation algorithm from its semantic interpretation, allowing developers to reuse complex Density functions for different purposes simply by providing a different SimpleNoiseCarta configuration. It operates on a 2D plane, making it ideal for generating top-down data maps.

### Lifecycle & Ownership
- **Creation:** A SimpleNoiseCarta is instantiated directly via its constructor, typically during the setup phase of a world generator or a specific biome provider. It is not managed by a central service locator or dependency injection framework. The creator is responsible for providing the necessary Density function and a default value.
- **Scope:** The object's lifetime is scoped to the specific generation task for which it was configured. It is a transient object, created, configured, used for a region's generation, and then discarded.
- **Destruction:** The object is managed by the Java garbage collector. It becomes eligible for collection as soon as the world generation process that created it completes and releases its reference. There are no manual cleanup or disposal methods.

## Internal State & Concurrency
- **State:** The class is stateful, containing references to a Density function, a DoubleRangeMap, and a default value. However, it is designed to be **effectively immutable after configuration**. The `put` method mutates the internal range map, but it is exclusively intended for use during the initial setup phase.
- **Thread Safety:** The core `apply` method is **thread-safe** and designed for high-concurrency execution by the world generation worker pool. This safety is contingent on a critical assumption: the internal state, particularly the DoubleRangeMap, is not modified via `put` after the generation process has begun. All operations within `apply` are read-only with respect to the object's internal state.

**WARNING:** The provided Density function must also be thread-safe for the overall operation to be safe.

## API Surface
The public API is minimal, focusing on configuration and evaluation.

| Symbol | Type | Complexity | Description |
| :--- | :--- | :--- | :--- |
| put(DoubleRange range, T value) | SimpleNoiseCarta<T> | O(log N) | Adds a mapping rule from a noise range to a value. Returns self for chaining. |
| apply(int x, int z, WorkerIndexer.Id id) | T | O(log N) | Evaluates the noise at a 2D coordinate and returns the corresponding mapped value. |
| allPossibleValues() | List<T> | O(N) | Returns a list of all configured output values, including the default. |

## Integration Patterns

### Standard Usage
The standard pattern involves instantiating the class, configuring its range-to-value mappings using the builder-style `put` method, and then passing the configured instance to a system that will invoke `apply` across many threads.

```java
// 1. Define the underlying noise function
Density terrainNoise = new PerlinNoise(...);

// 2. Create and configure the Carta
SimpleNoiseCarta<BiomeType> biomeCarta = new SimpleNoiseCarta<>(terrainNoise, BiomeType.PLAINS)
    .put(new DoubleRange(-1.0, -0.5), BiomeType.OCEAN)
    .put(new DoubleRange(-0.5, -0.3), BiomeType.BEACH)
    .put(new DoubleRange(-0.3, 0.7), BiomeType.FOREST);

// 3. Pass the configured instance to a generator for evaluation
worldGenerator.setBiomeProvider(biomeCarta);
worldGenerator.generateChunk(0, 0);
```

### Anti-Patterns (Do NOT do this)
- **Post-Initialization Mutation:** Modifying the carta with `put` after it has been handed off to the world generator is not thread-safe and will lead to unpredictable behavior, including `ConcurrentModificationException` or non-deterministic world generation. All configuration must happen before concurrent execution begins.
- **Overlapping Ranges:** Defining overlapping ranges with the `put` method can produce unexpected results. The behavior of the underlying DoubleRangeMap with overlapping keys is not guaranteed to be consistent or desirable for world generation.
- **Ignoring the Default Value:** Failing to provide a sensible `defaultValue` can lead to null values being returned from `apply` if the noise function produces a value outside all configured ranges. This can cause `NullPointerException` downstream in systems that expect a valid object.

## Data Pipeline
The SimpleNoiseCarta serves as a key transformation step in the world generation data pipeline.

> Flow:
> (X, Z) Coordinates -> Density Function -> Raw Noise Value (double) -> **SimpleNoiseCarta** -> Mapped Value (T) -> World Chunk Data

