---
description: Architectural reference for Mesh2DPositionProvider
---

# Mesh2DPositionProvider

**Package:** com.hypixel.hytale.builtin.hytalegenerator.positionproviders
**Type:** Transient

## Definition
```java
// Signature
public class Mesh2DPositionProvider extends PositionProvider {
```

## Architecture & Concepts
The Mesh2DPositionProvider is a specialized adapter within the world generation framework. Its primary function is to translate a two-dimensional point generation strategy into a three-dimensional position provider that operates on a single, fixed horizontal plane.

This class embodies the **Composition over Inheritance** principle. Instead of implementing complex 2D point generation logic itself, it delegates this responsibility to a supplied PointProvider instance. It then performs a simple but critical transformation: for every 2D point (x, z) generated by the delegate, it constructs a 3D vector (x, y, z) using its own configured, immutable Y-coordinate.

In the context of the broader world generator, this component is used to place features that are constrained to a specific altitude, such as placing flora on a flat ground plane or decorative items on a water surface. It effectively acts as a dimensional bridge, allowing 2D algorithms like Poisson disc sampling to be used for 3D placement without modification.

### Lifecycle & Ownership
-   **Creation:** Instantiated by higher-level generator configurations or feature placers during the setup phase of a world generation task. It is not managed by a central service registry.
-   **Scope:** The lifetime of a Mesh2DPositionProvider is typically short and bound to a specific generation operation, such as populating a single world chunk. It does not persist between sessions or across distant generation tasks.
-   **Destruction:** The object is eligible for garbage collection as soon as the parent generator that created it completes its work and releases its reference. No explicit cleanup methods are required.

## Internal State & Concurrency
-   **State:** The internal state consists of the `pointGenerator` delegate and the integer `y`. Both are `final` fields, making the object's configuration immutable after construction. It does not cache any generated data.
-   **Thread Safety:** This class is conditionally thread-safe. It contains no internal locks and does not modify its own state after construction. Its safety in a concurrent environment is entirely dependent on the thread safety of the `PointProvider` delegate and the `consumer` function passed into the `positionsIn` method.

    **Warning:** If the provided `pointGenerator` is stateful and not designed for concurrent access, using this provider from multiple threads will lead to race conditions and non-deterministic output.

## API Surface

| Symbol | Type | Complexity | Description |
| :--- | :--- | :--- | :--- |
| Mesh2DPositionProvider(provider, y) | constructor | O(1) | Constructs the provider with a 2D point generator and a fixed Y-level. |
| positionsIn(context) | void | O(N) | Generates all 3D positions and passes them to the context consumer. N is the number of points produced by the delegate PointProvider. |

## Integration Patterns

### Standard Usage
This provider is used to adapt a 2D point source (like a grid or random sampler) for use in a 3D placement system that requires positions at a constant height.

```java
// Assume 'gridPointProvider' is a PointProvider that generates points on a 2D grid.
// Assume 'generationContext' is a valid PositionProvider.Context.

// 1. Create the adapter for Y-level 64.
int waterLevel = 64;
PositionProvider surfacePositions = new Mesh2DPositionProvider(gridPointProvider, waterLevel);

// 2. Use the provider to generate positions.
// The consumer in the context will now receive Vector3d objects, all with y=64.
surfacePositions.positionsIn(generationContext);
```

### Anti-Patterns (Do NOT do this)
-   **Volumetric Placement:** Do not use this provider when you need to place objects throughout a 3D volume. It is highly inefficient as it only ever produces points on a single Y-level and will do no work for any other part of the volume.
-   **Misconfigured Context:** Passing a context whose vertical bounds (`minInclusive.y` to `maxExclusive.y`) do not include the provider's configured `y` value is wasteful. The provider includes an early-exit optimization, but repeated calls indicate a logical error in the generator design.

## Data Pipeline
The primary flow involves receiving a 3D request, projecting it down to 2D for the delegate, and lifting the 2D results back up to 3D.

> Flow:
> `positionsIn(Context)` -> Y-Level Check -> 3D Bounds to 2D Projection -> **Delegate `pointGenerator.points2d()`** -> 2D Point to 3D Vector Transformation -> `Context.consumer.accept()`

