---
description: Architectural reference for SpherePositionProvider
---

# SpherePositionProvider

**Package:** com.hypixel.hytale.builtin.hytalegenerator.positionproviders
**Type:** Transient Component

## Definition
```java
// Signature
public class SpherePositionProvider extends PositionProvider {
```

## Architecture & Concepts
The SpherePositionProvider is a component within the world generation system that acts as a spatial filter. It implements the **Decorator** design pattern, wrapping another PositionProvider to constrain its output. Its sole responsibility is to ensure that any position vector passed through it has a magnitude (a distance from the origin) less than or equal to a configured range.

This class is a fundamental building block for creating complex geometric shapes during world generation. It is typically chained with other providers to carve out spherical volumes from other, more primitive shapes like grids or random distributions.

The core filtering mechanism is achieved by intercepting the `consumer` function within the execution `Context`. Instead of passing the context directly to the wrapped provider, it creates a new context with a custom consumer. This new consumer first validates a candidate position against the spherical constraint before forwarding it to the original, downstream consumer.

## Lifecycle & Ownership
- **Creation:** Instantiated programmatically during the setup phase of a world generation task. It is never managed by a dependency injection container and is constructed with its dependencies (the wrapped provider and range) provided directly.
- **Scope:** The object's lifetime is ephemeral, strictly tied to a single, specific generation operation. It is created, used once for a `positionsIn` call, and then becomes eligible for garbage collection.
- **Destruction:** Cleanup is managed entirely by the Java Garbage Collector. There are no native resources or explicit `close` methods.

## Internal State & Concurrency
- **State:** The internal state, consisting of the wrapped `positionProvider` and the `range`, is **immutable** after construction. The class itself is stateless during the `positionsIn` operation, with all transient data being passed within the `Context` parameter.
- **Thread Safety:** This class is inherently thread-safe and re-entrant. Its immutability prevents internal data races. The overall thread safety of an operation involving this class is dependent on the thread safety of the wrapped PositionProvider and the downstream consumer function provided in the `Context`.

## API Surface

| Symbol | Type | Complexity | Description |
| :--- | :--- | :--- | :--- |
| positionsIn(Context context) | void | O(N) | Executes the wrapped provider and filters its emitted positions. Only positions within the spherical range are passed to the context consumer. N is the number of positions generated by the wrapped provider. |

## Integration Patterns

### Standard Usage
This provider is designed to be composed with other providers. The standard pattern is to instantiate a base provider and then wrap it with a SpherePositionProvider to apply the filter.

```java
// 1. Define a base provider, for example, one that generates positions in a box.
PositionProvider boxProvider = new BoxPositionProvider(min, max);

// 2. Wrap the base provider to filter its results into a sphere of radius 64.
double radius = 64.0;
PositionProvider sphereFilter = new SpherePositionProvider(boxProvider, radius);

// 3. Execute the chain. The context's consumer will only receive positions
//    that were inside the original box AND inside the sphere.
PositionProvider.Context context = buildGeneratorContext();
sphereFilter.positionsIn(context);
```

### Anti-Patterns (Do NOT do this)
- **Misunderstanding Origin:** Do not assume this provider can be translated. The spherical filter is *always* centered at the local origin (0, 0, 0). To create an offset sphere, you must first use a provider that translates the entire coordinate space, such as a `TranslatePositionProvider`, before positions are generated and filtered.
- **Inefficient Chaining:** Chaining this provider before a broader, less expensive filter can be inefficient. For example, filtering a massive volume with a sphere before filtering by a simple bounding box forces a distance calculation on many points that would have been discarded anyway. Always apply the cheapest and broadest filters first.

## Data Pipeline
The SpherePositionProvider functions as an intermediate processing stage in a data pipeline. It receives a stream of position vectors from an upstream source and conditionally forwards them to a downstream sink.

> Flow:
> Upstream PositionProvider -> **SpherePositionProvider (Filter by distance)** -> Downstream Context Consumer -> World Generation Engine

