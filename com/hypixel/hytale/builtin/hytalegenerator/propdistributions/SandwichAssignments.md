---
description: Architectural reference for SandwichAssignments
---

# SandwichAssignments

**Package:** com.hypixel.hytale.builtin.hytalegenerator.propdistributions
**Type:** Transient Strategy Object

## Definition
```java
// Signature
public class SandwichAssignments extends Assignments {
```

## Architecture & Concepts
The SandwichAssignments class implements a vertical layering strategy for procedural prop generation. The "Sandwich" metaphor describes its function: it divides the world into horizontal slices based on Y-axis elevation and applies different prop assignment rules to each slice.

This class acts as a specialized composite or router within the world generation framework. When the generator requests a prop for a given 3D position, SandwichAssignments first determines which vertical layer the position falls into. It then delegates the final prop selection logic to a more specific Assignments object contained within that layer.

This mechanism is fundamental for creating vertically stratified environments, such as caves with different flora at the floor and ceiling, or mountains with distinct vegetation zones at varying altitudes. It allows world designers to compose complex biome definitions from simpler, reusable rule sets.

## Lifecycle & Ownership
- **Creation:** Instantiated by a higher-level configuration system during the world generation bootstrap phase. It is typically constructed from parsed biome or zone definition files, not created dynamically by game logic.
- **Scope:** The object's lifetime is tied to a specific world generation session. Once created, it is treated as an immutable configuration object and is used by multiple worker threads to generate world chunks. It does not persist beyond the generation task.
- **Destruction:** The object has no explicit destruction or cleanup logic. It becomes eligible for garbage collection once the world generator that owns it completes its work and all references are released.

## Internal State & Concurrency
- **State:** The internal state is **effectively immutable**. The core data structure, a list of VerticalDelimiter objects, is defensively copied in the constructor. This prevents any external modification after the object has been instantiated, ensuring predictable behavior throughout its lifecycle.
- **Thread Safety:** This class is **thread-safe for all read operations**. Because its internal state is never mutated after construction, multiple world generation worker threads can call its methods, particularly propAt, concurrently without any need for external locks or synchronization. This design is critical for achieving high performance in a parallelized world generation engine.

## API Surface
| Symbol | Type | Complexity | Description |
| :--- | :--- | :--- | :--- |
| propAt(position, id, distance) | Prop | O(N) | Determines the correct prop for a given position. Scans N vertical layers and delegates to the first one that contains the position's Y-coordinate. Returns a no-prop sentinel if the position is outside all defined layers. |
| getRuntime() | int | O(1) | Returns a pre-calculated runtime metric associated with this assignment configuration. |
| getAllPossibleProps() | List<Prop> | O(N*M) | Aggregates and returns a list of all unique props that could possibly be generated by any of the configured vertical layers. |

*N = number of VerticalDelimiter layers*
*M = complexity of the delegated getAllPossibleProps call*

## Integration Patterns

### Standard Usage
A SandwichAssignments object is configured and instantiated by a central world generator or biome factory. It is then passed as part of a larger configuration context to worker threads responsible for generating terrain chunks.

```java
// Example: Configuration within a biome definition
List<SandwichAssignments.VerticalDelimiter> layers = new ArrayList<>();

// Layer 1: Cave Floor (Y = 0 to 10)
layers.add(new SandwichAssignments.VerticalDelimiter(caveFloorAssignments, 0.0, 10.0));

// Layer 2: Cave Walls (Y = 10 to 40)
layers.add(new SandwichAssignments.VerticalDelimiter(caveWallAssignments, 10.0, 40.0));

// The final object used by the generator
Assignments verticalStrategy = new SandwichAssignments(layers, 50);

// A worker thread would then use it
Prop p = verticalStrategy.propAt(new Vector3d(100, 15, 200), workerId, 0.5);
```

### Anti-Patterns (Do NOT do this)
- **Overlapping Layers:** The implementation performs a linear scan and returns upon the first match. Defining layers with overlapping Y-ranges will cause unpredictable behavior, as the layer that appears first in the constructor's list will always win. Ensure all VerticalDelimiter ranges are mutually exclusive.
- **Excessive Layering:** While powerful, using a very large number of layers will degrade performance, as the propAt method must iterate through the list for every block column. For highly complex vertical logic, consider a more optimized data structure or a different approach.
- **Dynamic Modification:** Do not attempt to modify the state of a SandwichAssignments object or its children after it has been passed to the world generation engine. The system relies on these objects being immutable for thread safety.

## Data Pipeline
The data flow for this component is a simple delegation chain within the prop generation system.

> Flow:
> World Generation Worker -> Requests Prop at **Vector3d** -> `Assignments.propAt()` -> **SandwichAssignments** -> Selects `VerticalDelimiter` via `Vector3d.y` -> Delegates to `child.Assignments.propAt()` -> Returns **Prop**

