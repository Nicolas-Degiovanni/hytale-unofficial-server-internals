---
description: Architectural reference for QueueMaterialProvider
---

# QueueMaterialProvider

**Package:** com.hypixel.hytale.builtin.hytalegenerator.materialproviders
**Type:** Transient

## Definition
```java
// Signature
public class QueueMaterialProvider<V> extends MaterialProvider<V> {
```

## Architecture & Concepts
The QueueMaterialProvider is a composite component that implements the **Chain of Responsibility** design pattern for voxel material selection. Its primary role is to orchestrate a sequence of other MaterialProvider instances, effectively creating a prioritized layering system for world generation.

When asked to provide a material for a specific location, this class iterates through its internal, ordered queue of providers. It queries each provider in sequence until one returns a non-null material. That material is immediately returned, and the process stops. This establishes a clear hierarchy: providers earlier in the queue have higher priority and can override or "paint over" the materials that would have been generated by later providers.

This mechanism is fundamental for creating complex and layered terrain. A typical setup might involve a base stone provider at the end of the queue, with providers for dirt, grass, ores, and special features placed before it, each carving out its designated region.

### Lifecycle & Ownership
-   **Creation:** Instantiated by a higher-level world generation service or configuration loader when building a specific generator pipeline. It is not a globally managed service but a configurable part of a larger generation algorithm.
-   **Scope:** The lifetime of a QueueMaterialProvider is tied to the world generator instance that owns it. It is created to fulfill a specific generation strategy and is discarded when that generator is no longer needed.
-   **Destruction:** The object is managed by the Java garbage collector. It holds no native resources and requires no explicit cleanup. It is eligible for collection once its parent generator is dereferenced.

## Internal State & Concurrency
-   **State:** The internal state is the `queue` array of MaterialProviders. This state is **effectively immutable**. The constructor performs a defensive copy of the incoming list into a private final array, preventing any external modification after instantiation.
-   **Thread Safety:** This class is **conditionally thread-safe**. The read-only nature of its internal state and the lack of synchronization in its `getVoxelTypeAt` method mean its thread safety is entirely dependent on the thread safety of the MaterialProvider instances it contains. If all providers in the queue are themselves thread-safe, then a QueueMaterialProvider instance can be safely shared across multiple world generation threads.

## API Surface

| Symbol | Type | Complexity | Description |
| :--- | :--- | :--- | :--- |
| getVoxelTypeAt(Context) | V | O(N) | Queries the internal sequence of providers and returns the first non-null material. N is the number of providers in the queue. |

## Integration Patterns

### Standard Usage
The class is intended to be composed with other providers to define a material hierarchy. The order of the list passed to the constructor is critical.

```java
// Define the layers, from highest to lowest priority
List<MaterialProvider<BlockType>> layers = List.of(
    new GrassLayerProvider(),      // Top layer
    new DirtLayerProvider(),       // Below grass
    new BaseStoneProvider()        // Fallback base material
);

// Create the composite provider
MaterialProvider<BlockType> terrainProvider = new QueueMaterialProvider<>(layers);

// Use the provider to get a material for a specific location
BlockType block = terrainProvider.getVoxelTypeAt(generationContext);
```

### Anti-Patterns (Do NOT do this)
-   **Incorrect Ordering:** Placing a generic, high-coverage provider (like a base stone layer) at the beginning of the queue is a severe configuration error. It will always return a material, effectively shadowing and disabling all subsequent providers in the chain.
-   **Mutable Contained Providers:** While this class is internally immutable, passing it providers that have mutable state that is not thread-safe can introduce race conditions if the QueueMaterialProvider is used concurrently by multiple threads.

## Data Pipeline
The QueueMaterialProvider acts as a decision node within the broader world generation data pipeline. It takes a spatial query and resolves it to a single material type by delegating to a prioritized sequence of sub-routines.

> Flow:
> World Generator Request (x, y, z) -> MaterialProvider.Context Creation -> **QueueMaterialProvider.getVoxelTypeAt(context)** -> Iteration [Provider1, Provider2, ...] -> First Non-Null Material -> Voxel Chunk Buffer

